# frozen_string_literal: true

require "test_helper"

class TestCLIPercentProgressBar < Minitest::Test
  def setup
    @stream = StringIO.new
  end

  def test_example_1
    progress_bar = CLIProgressBar.new(of: "2.3 MiB", stream: @stream)

    progress_bar.update(20)
    progress_bar.update(40)
    progress_bar.update(60)
    progress_bar.update(80)
    progress_bar.update(100)

    expected = <<~OUTPUT
[----------->                                                ]  20% of 2.3 MiB
[----------------------->                                    ]  40% of 2.3 MiB
[----------------------------------->                        ]  60% of 2.3 MiB
[----------------------------------------------->            ]  80% of 2.3 MiB
[----------------------------------------------------------->]  100% of 2.3 MiB
    OUTPUT

    assert_equal expected, @stream.string
  end

  def test_example_2
    progress_bar = CLIProgressBar::PercentProgressBar.new(
      of: "2.3 MiB", log_at: CLIProgressBar::LOG_AT_ALL_PERCENTS,
      bar_length: 50, line_char: "=", prefix: "Progress:", suffix: "complete", stream: @stream
    )
    10.times { |i| progress_bar.update((i+1) * 10) }

    expected = <<~OUTPUT
Progress:  [====>                                             ]  10% of 2.3 MiB complete
Progress:  [=========>                                        ]  20% of 2.3 MiB complete
Progress:  [==============>                                   ]  30% of 2.3 MiB complete
Progress:  [===================>                              ]  40% of 2.3 MiB complete
Progress:  [========================>                         ]  50% of 2.3 MiB complete
Progress:  [=============================>                    ]  60% of 2.3 MiB complete
Progress:  [==================================>               ]  70% of 2.3 MiB complete
Progress:  [=======================================>          ]  80% of 2.3 MiB complete
Progress:  [============================================>     ]  90% of 2.3 MiB complete
Progress:  [=================================================>]  100% of 2.3 MiB complete
    OUTPUT
    assert_equal expected, @stream.string
  end

  def test_example_5
    progress_bar = CLIProgressBar::PercentProgressBar.new(
      of: "1 GiB", log_at: CLIProgressBar::LOG_AT_QUARTER_PERCENTS,
      bar_length: 80, stream: @stream
    )
    100.times { progress_bar.increment }

    expected = <<~OUTPUT
[------------------->                                                            ]  25% of 1 GiB
[--------------------------------------->                                        ]  50% of 1 GiB
[----------------------------------------------------------->                    ]  75% of 1 GiB
[------------------------------------------------------------------------------->]  100% of 1 GiB
    OUTPUT
    assert_equal expected, @stream.string
  end

  def test_example_6
    progress_bar = CLIProgressBar::PercentProgressBar.new(
      of: "1 GiB", log_at: CLIProgressBar::LOG_AT_ALL_PERCENTS, stream: @stream
    )
    progress_bar.increment(by: 5)
    progress_bar.increment
    progress_bar.increment
    progress_bar.increment
    progress_bar.increment(by: 2)
    progress_bar.update(40)
    progress_bar.increment(by: 40, suffix: "Almost there!")
    progress_bar.update(100, suffix: "Complete :-)")

    expected = <<~OUTPUT
[-->                                                         ]  5% of 1 GiB
[-->                                                         ]  6% of 1 GiB
[--->                                                        ]  7% of 1 GiB
[--->                                                        ]  8% of 1 GiB
[----->                                                      ]  10% of 1 GiB
[----------------------->                                    ]  40% of 1 GiB
[----------------------------------------------->            ]  80% of 1 GiB Almost there!
[----------------------------------------------------------->]  100% of 1 GiB Complete :-)
    OUTPUT
    assert_equal expected, @stream.string
  end

  def test_example_8
    progress_bar = CLIProgressBar::PercentProgressBar.new(
      log_at: CLIProgressBar::LOG_AT_ALL_PERCENTS, bar_length: 100, stream: @stream
    )
    100.times { progress_bar.increment }

    expected = <<~OUTPUT
[>                                                                                                   ]  1%
[->                                                                                                  ]  2%
[-->                                                                                                 ]  3%
[--->                                                                                                ]  4%
[---->                                                                                               ]  5%
[----->                                                                                              ]  6%
[------>                                                                                             ]  7%
[------->                                                                                            ]  8%
[-------->                                                                                           ]  9%
[--------->                                                                                          ]  10%
[---------->                                                                                         ]  11%
[----------->                                                                                        ]  12%
[------------>                                                                                       ]  13%
[------------->                                                                                      ]  14%
[-------------->                                                                                     ]  15%
[--------------->                                                                                    ]  16%
[---------------->                                                                                   ]  17%
[----------------->                                                                                  ]  18%
[------------------>                                                                                 ]  19%
[------------------->                                                                                ]  20%
[-------------------->                                                                               ]  21%
[--------------------->                                                                              ]  22%
[---------------------->                                                                             ]  23%
[----------------------->                                                                            ]  24%
[------------------------>                                                                           ]  25%
[------------------------->                                                                          ]  26%
[-------------------------->                                                                         ]  27%
[--------------------------->                                                                        ]  28%
[---------------------------->                                                                       ]  29%
[----------------------------->                                                                      ]  30%
[------------------------------>                                                                     ]  31%
[------------------------------->                                                                    ]  32%
[-------------------------------->                                                                   ]  33%
[--------------------------------->                                                                  ]  34%
[---------------------------------->                                                                 ]  35%
[----------------------------------->                                                                ]  36%
[------------------------------------>                                                               ]  37%
[------------------------------------->                                                              ]  38%
[-------------------------------------->                                                             ]  39%
[--------------------------------------->                                                            ]  40%
[---------------------------------------->                                                           ]  41%
[----------------------------------------->                                                          ]  42%
[------------------------------------------>                                                         ]  43%
[------------------------------------------->                                                        ]  44%
[-------------------------------------------->                                                       ]  45%
[--------------------------------------------->                                                      ]  46%
[---------------------------------------------->                                                     ]  47%
[----------------------------------------------->                                                    ]  48%
[------------------------------------------------>                                                   ]  49%
[------------------------------------------------->                                                  ]  50%
[-------------------------------------------------->                                                 ]  51%
[--------------------------------------------------->                                                ]  52%
[---------------------------------------------------->                                               ]  53%
[----------------------------------------------------->                                              ]  54%
[------------------------------------------------------>                                             ]  55%
[------------------------------------------------------->                                            ]  56%
[-------------------------------------------------------->                                           ]  57%
[--------------------------------------------------------->                                          ]  58%
[---------------------------------------------------------->                                         ]  59%
[----------------------------------------------------------->                                        ]  60%
[------------------------------------------------------------>                                       ]  61%
[------------------------------------------------------------->                                      ]  62%
[-------------------------------------------------------------->                                     ]  63%
[--------------------------------------------------------------->                                    ]  64%
[---------------------------------------------------------------->                                   ]  65%
[----------------------------------------------------------------->                                  ]  66%
[------------------------------------------------------------------>                                 ]  67%
[------------------------------------------------------------------->                                ]  68%
[-------------------------------------------------------------------->                               ]  69%
[--------------------------------------------------------------------->                              ]  70%
[---------------------------------------------------------------------->                             ]  71%
[----------------------------------------------------------------------->                            ]  72%
[------------------------------------------------------------------------>                           ]  73%
[------------------------------------------------------------------------->                          ]  74%
[-------------------------------------------------------------------------->                         ]  75%
[--------------------------------------------------------------------------->                        ]  76%
[---------------------------------------------------------------------------->                       ]  77%
[----------------------------------------------------------------------------->                      ]  78%
[------------------------------------------------------------------------------>                     ]  79%
[------------------------------------------------------------------------------->                    ]  80%
[-------------------------------------------------------------------------------->                   ]  81%
[--------------------------------------------------------------------------------->                  ]  82%
[---------------------------------------------------------------------------------->                 ]  83%
[----------------------------------------------------------------------------------->                ]  84%
[------------------------------------------------------------------------------------>               ]  85%
[------------------------------------------------------------------------------------->              ]  86%
[-------------------------------------------------------------------------------------->             ]  87%
[--------------------------------------------------------------------------------------->            ]  88%
[---------------------------------------------------------------------------------------->           ]  89%
[----------------------------------------------------------------------------------------->          ]  90%
[------------------------------------------------------------------------------------------>         ]  91%
[------------------------------------------------------------------------------------------->        ]  92%
[-------------------------------------------------------------------------------------------->       ]  93%
[--------------------------------------------------------------------------------------------->      ]  94%
[---------------------------------------------------------------------------------------------->     ]  95%
[----------------------------------------------------------------------------------------------->    ]  96%
[------------------------------------------------------------------------------------------------>   ]  97%
[------------------------------------------------------------------------------------------------->  ]  98%
[--------------------------------------------------------------------------------------------------> ]  99%
[--------------------------------------------------------------------------------------------------->]  100%
    OUTPUT
    assert_equal expected, @stream.string
  end

  def test_remaining_length_minus_one
    progress_bar = CLIProgressBar::PercentProgressBar.new(
      stream: @stream, log_at: CLIProgressBar::LOG_AT_ALL_PERCENTS
    )
    100.times { progress_bar.increment }

    expected = <<~OUTPUT
[>                                                           ]  1%
[>                                                           ]  2%
[>                                                           ]  3%
[->                                                          ]  4%
[-->                                                         ]  5%
[-->                                                         ]  6%
[--->                                                        ]  7%
[--->                                                        ]  8%
[---->                                                       ]  9%
[----->                                                      ]  10%
[----->                                                      ]  11%
[------>                                                     ]  12%
[------>                                                     ]  13%
[------->                                                    ]  14%
[-------->                                                   ]  15%
[-------->                                                   ]  16%
[--------->                                                  ]  17%
[--------->                                                  ]  18%
[---------->                                                 ]  19%
[----------->                                                ]  20%
[----------->                                                ]  21%
[------------>                                               ]  22%
[------------>                                               ]  23%
[------------->                                              ]  24%
[-------------->                                             ]  25%
[-------------->                                             ]  26%
[--------------->                                            ]  27%
[--------------->                                            ]  28%
[---------------->                                           ]  29%
[----------------->                                          ]  30%
[----------------->                                          ]  31%
[------------------>                                         ]  32%
[------------------>                                         ]  33%
[------------------->                                        ]  34%
[-------------------->                                       ]  35%
[-------------------->                                       ]  36%
[--------------------->                                      ]  37%
[--------------------->                                      ]  38%
[---------------------->                                     ]  39%
[----------------------->                                    ]  40%
[----------------------->                                    ]  41%
[------------------------>                                   ]  42%
[------------------------>                                   ]  43%
[------------------------->                                  ]  44%
[-------------------------->                                 ]  45%
[-------------------------->                                 ]  46%
[--------------------------->                                ]  47%
[--------------------------->                                ]  48%
[---------------------------->                               ]  49%
[----------------------------->                              ]  50%
[----------------------------->                              ]  51%
[------------------------------>                             ]  52%
[------------------------------>                             ]  53%
[------------------------------->                            ]  54%
[-------------------------------->                           ]  55%
[-------------------------------->                           ]  56%
[--------------------------------->                          ]  57%
[--------------------------------->                          ]  58%
[---------------------------------->                         ]  59%
[----------------------------------->                        ]  60%
[----------------------------------->                        ]  61%
[------------------------------------>                       ]  62%
[------------------------------------>                       ]  63%
[------------------------------------->                      ]  64%
[-------------------------------------->                     ]  65%
[-------------------------------------->                     ]  66%
[--------------------------------------->                    ]  67%
[--------------------------------------->                    ]  68%
[---------------------------------------->                   ]  69%
[----------------------------------------->                  ]  70%
[----------------------------------------->                  ]  71%
[------------------------------------------>                 ]  72%
[------------------------------------------>                 ]  73%
[------------------------------------------->                ]  74%
[-------------------------------------------->               ]  75%
[-------------------------------------------->               ]  76%
[--------------------------------------------->              ]  77%
[--------------------------------------------->              ]  78%
[---------------------------------------------->             ]  79%
[----------------------------------------------->            ]  80%
[----------------------------------------------->            ]  81%
[------------------------------------------------>           ]  82%
[------------------------------------------------>           ]  83%
[------------------------------------------------->          ]  84%
[-------------------------------------------------->         ]  85%
[-------------------------------------------------->         ]  86%
[--------------------------------------------------->        ]  87%
[--------------------------------------------------->        ]  88%
[---------------------------------------------------->       ]  89%
[----------------------------------------------------->      ]  90%
[----------------------------------------------------->      ]  91%
[------------------------------------------------------>     ]  92%
[------------------------------------------------------>     ]  93%
[------------------------------------------------------->    ]  94%
[-------------------------------------------------------->   ]  95%
[-------------------------------------------------------->   ]  96%
[--------------------------------------------------------->  ]  97%
[--------------------------------------------------------->  ]  98%
[----------------------------------------------------------> ]  99%
[----------------------------------------------------------->]  100%
    OUTPUT
    assert_equal expected, @stream.string
  end
end
